/*! WKeditor - v1.0 - 2013-10-24 5:14:01 PM
* Copyright (c) 2013 changyuan.lcy; Licensed  */
KISSY.add(function(a,b,c){function d(a){var b=this;b.options=a}var e=b.all;return d.prototype.tpl={font:{hugeFont:{text:"\u8d85\u5927\u5b57\u4f53",size:"6",command:"setFontSize"},largeFont:{text:"\u5927\u5b57\u4f53",size:"4",command:"setFontSize"},normalFont:{text:"\u8fd8\u539f\u5b57\u4f53",size:"2",command:"setFontSize"},strongFont:{text:"\u6587\u5b57\u52a0\u7c97",command:"setFontBold"},listText:{text:"\u5217\u8868",command:"insertUnorderedList"},italicText:{text:"\u659c\u4f53",command:"setContentItalic"}},wrap:"<div class='WKeditor_font_plate'></div>",btn:"<div class='box'>{{#each data}}<button command='{{command}}' {{#if size}} size='{{size}}' {{/if}}  class='{{name}} command' title='{{text}}'></button>{{/each}}</div>",arrow:"<div class='arrow'></div>"},d.prototype.view=function(){var a=this;if(a.view.render=function(){a.$font.width(32*a.$font.all("button").length)},a.$font=e(a.tpl.wrap),arr=[],temp="",a.config)for(var b=0,d=a.config.length;d>b;b++)arr[b]={name:a.config[b],command:a.tpl.font[a.config[b]].command,size:a.tpl.font[a.config[b]].size,text:a.tpl.font[a.config[b]].text};temp=new c(a.tpl.btn).render({data:arr}),a.$font.append(temp),a.$font.append(a.tpl.arrow),a.view.render(),a.ele.append(a.$font)},d.prototype.event=function(){var b=this;b.$font.all("button").on("click",function(){var a=e(this).attr("command");return"setFontSize"==a?b.command[a](e(this).attr("size")):b.command[a](),!1}),b.$wrap.on("mousedown",function(a){b.options.mousedown=!0,b.options.mouseOD={left:a.clientX,top:a.clientY+e(window).scrollTop()},b.$font.hide(),b.options.range&&b.tool.setCart(b.$wrap[0],b.options.range),b.$wrap.fire("click")}).on("mouseup",function(a){b.options.mouseOU={left:a.clientX,top:a.clientY+e(window).scrollTop()},b.options.mousedown=!1;var c=b.tool.getRange(),d=b.options.mouseOD.left-(b.options.mouseOD.left-b.options.mouseOU.left)/2-b.$font.width()/2,f=b.options.mouseOD.top-(b.options.mouseOD.top-b.options.mouseOU.top)/2-b.$font.height()-20;d+b.$font.width()/2<b.ele.offset().left&&(d=b.ele.offset().left-b.$font.width()/2),d+b.$font.width()/2>b.ele.offset().left+b.ele.width()&&(d=b.ele.offset().left+b.ele.width()-b.$font.width()/2),f<b.ele.offset().top&&(f=b.ele.offset().top-b.$font.height()-10),f>b.ele.offset().top+b.ele.height()&&(f=b.ele.offset().top+b.ele.height()-b.$font.height()-10),b.options.range=c,setTimeout(function(){try{c.selectText&&(b.$font.show(),b.$font.css({left:d-b.left,top:f-b.top}))}catch(a){}},1)}),e(document).on("mouseup",function(c){return b.options.mousedown?(b.$wrap.fire("mouseup",c),b.options.mouseOU={left:c.clientX,top:c.clientY+e(window).scrollTop()}):a.inArray(c.target,b.$font.all("button"))||b.$font.hide(),!1})},d.prototype.command={setFontBold:function(){document.execCommand("Bold",!1,!0)},setContentItalic:function(){document.execCommand("Italic",!1,!0)},setContentUnderline:function(){document.execCommand("Underline",!1,!0)},setFontSize:function(a){document.execCommand("FontSize",!1,a),"2"==a&&document.execCommand("RemoveFormat")},insertUnorderedList:function(){document.execCommand("InsertUnorderedList",!1,null)}},d.prototype.init=function(a){this.ele=this.options.ele,this.left=this.options.left,this.top=this.options.top,this.$wrap=this.options.$wrap,this.config=a,this.tool=this.options.tool,this.browser=this.tool.browser(),this.view(),this.event()},d},{requires:["node","xtemplate","./WKfont.css"]});